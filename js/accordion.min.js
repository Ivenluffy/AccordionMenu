(function(e,t){typeof exports==="object"&&typeof module!=="undefined"?module.exports=t():typeof define==="function"&&define.amd?define(t):(e=e||self,e.Accordion=t())})(this,function(){"use strict";function extend(e,t,n){n=typeof n==="undefined"?true:toBool(n);for(var r in t){if(e.hasOwnProperty(r)&&!n)continue;e[r]=t[r]}return e}function toBool(e){return typeof e==="string"&&e.toLowerCase()==="false"?false:Boolean(e)}function parseObj(e,t){if(e&&typeof e==="object"){return e}else if(e&&typeof e==="string"){try{return JSON.parse(e)}catch(e){console.error(e.message)}}else{return t||null}}function copyObj(e){return JSON.parse(JSON.stringify(e))}function createRequest(){if(window.XMLHttpRequest){return new XMLHttpRequest}else if(window.ActiveXObject){var e=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Msxml2.XMLHTTP","Microsoft.XMLHTTP"];for(var t=0;t<e.length;t++){try{return new ActiveXObject(e[t])}catch(e){}}}return null}function gradientColors(e,t,n){var r=g(e);var o=r[0];var i=r[1];var a=r[2];var s=g(t);var l=s[0];var u=s[1];var d=s[2];var c=(l-o)/n;var p=(u-i)/n;var f=(d-a)/n;var h=[];for(var m=0;m<n;m++){var v=y("rgb("+parseInt(c*m+o)+","+parseInt(p*m+i)+","+parseInt(f*m+a)+")");h.push(v)}return h;function g(e){var t=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;var e=e.toLowerCase();if(e&&t.test(e)){if(e.length===4){var n="#";for(var r=1;r<4;r+=1){n+=e.slice(r,r+1).concat(e.slice(r,r+1))}e=n}var o=[];for(var r=1;r<7;r+=2){o.push(parseInt("0x"+e.slice(r,r+2)))}return o}else{return e}}function y(e){var t=e;var n=/^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;if(/^(rgb|RGB)/.test(t)){var r=t.replace(/(?:(|)|rgb|RGB)*/g,"").split(",");var o="#";for(var i=0;i<r.length;i++){var a=Number(r[i]).toString(16);a=a<10?0+""+a:a;if(a==="0"){a+=a}o+=a}if(o.length!==7){o=t}return o}else if(n.test(t)){var s=t.replace(/#/,"").split("");if(s.length===6){return t}else if(s.length===3){var l="#";for(var i=0;i<s.length;i+=1){l+=s[i]+s[i]}return l}}else{return t}}}function sortTreeArr(e,t,n,r){r=r||"asc";if(!n)return e;var o=1;if(r&&r.toLowerCase()=="desc")o=-1;for(var i=0;i<e.length;i++){if(e[i][t])sortTreeArr(e[i][t],t,n,r)}sortArr(e,r,n);return e}function sortArr(e,t,o){o=o||"";var i=1;if(t&&t.toLowerCase()=="desc")i=-1;e.sort(function(e,t){var n,r;n=o?e[o]:e;r=o?t[o]:t;if(n>r){return 1*i}else if(n<r){return-1*i}else{return 0*i}});return e}function addEvent(e,t,n,r){r=toBool(r);e.addEventListener?e.addEventListener(t,n,r):e.attachEvent?e.attachEvent("on"+t,n,r):e["on"+t]=n}function removeEvent(e,t,n,r){r=toBool(r);e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent("on"+t,n,r)}function elData(e,t,n){var r="_elData",o=typeof t,i=typeof n;t=o==="string"?t.trim():t;if(o!=="undefined"&&i!=="undefined"){if(t===null||o==="number"||o==="boolean"){return e}if(!(r in e)){e[r]={}}e[r][t]=n;return e}if(o==="undefined"&&i==="undefined"){return e[r]||{}}if(o!=="undefined"&&i==="undefined"){return r in e&&t in e[r]?e[r][t]:undefined}}function delElData(e,t){var n=typeof t,r="_elData";t=n==="string"?t.trim():t;if(t===null||n==="number"||n==="boolean"){return e}if(n==="undefined"){if(r in e)delete e[r]}else{if(r in e&&t in e[r])delete e[r][t]}return e}function slideDown(e,t){var n=window.getComputedStyle?getComputedStyle(e,null)["display"]:e.currentStyle["display"];if(n==="none"){e.style.cssText="height:0;display:block"}var r=0,o=e.scrollHeight,i=(t?o/t:o/300)*5;if(!e.offsetHeight){var a=setInterval(function(){if(r===o){clearInterval(a);e.style.cssText="display:block"}else{r+=i;r=r>o?o:r;e.style.height=r+"px"}},5)}}function slideUp(e,t){var n=0,r=e.scrollHeight,o=(t?r/t:r/300)*5;if(e.offsetHeight){var i=setInterval(function(){if(r===n){clearInterval(i);e.style.cssText="display:none"}else{r-=o;r=r<n?n:r;e.style.height=r+"px"}},5)}}function Accordion(e,t){if(!(this instanceof Accordion)){return new Accordion(e,t)}this.menu=typeof e==="string"?document.querySelector(e):(typeof HTMLElement==="object"?e instanceof HTMLElement:e&&typeof e==="object"&&e.nodeType===1&&typeof e.nodeName==="string")?e:null;this.options={};this.menu.classList.add("accordion");this.init(t)}Accordion.prototype={constructor:Accordion,init:function(options){var lastOpts=elData(this.menu,"lastOpts"),menu=this.menu;this.options=lastOpts||{idField:menu.getAttribute("idField")||"id",parentField:menu.getAttribute("parentField")||"pid",nameField:menu.getAttribute("nameField")||"name",iconField:menu.getAttribute("iconField")||"",sortName:menu.getAttribute("sortName")||"",sortOrder:menu.getAttribute("sortOrder")||"asc",childrenField:menu.getAttribute("childrenField")||"children",url:menu.getAttribute("url")||"",ajaxType:menu.getAttribute("ajaxType")||"get",ajaxData:menu.getAttribute("ajaxData")||null,asTreeData:menu.getAttribute("asTreeData")?toBool(menu.getAttribute("asTreeData")):true,data:menu.getAttribute("data")||null,indentStep:menu.getAttribute("indentStep")||1,startColor:menu.getAttribute("startColor")||"#18626b",endColor:menu.getAttribute("endColor")||"#2fb9ca",colorCount:menu.getAttribute("colorCount")||5,speed:menu.getAttribute("speed")||300,onnodeclick:eval(menu.getAttribute("onnodeclick"))||null,onnodemouseenter:eval(menu.getAttribute("onnodemouseenter"))||null,onnodemouseleave:eval(menu.getAttribute("onnodemouseleave"))||null,onmenuready:eval(menu.getAttribute("onmenuready"))||null};this.options=extend(this.options,options||{},true);var opts=this.options,_this=this,colorList=gradientColors(opts.startColor,opts.endColor,opts.colorCount);setOpts();render();bindEvent();return this;function setOpts(){opts.ajaxData=parseObj(opts.ajaxData);opts.data=parseObj(opts.data);if(!opts.data){urlGetData()}opts.data=getFmtData(opts.asTreeData);if(opts.asTreeData){elData(menu,"tree",opts.data);elData(menu,"list",getFmtData(!opts.asTreeData))}else{elData(menu,"list",opts.data);elData(menu,"tree",getFmtData(!opts.asTreeData))}if(!lastOpts){for(var e in opts){menu.removeAttribute(e)}}elData(menu,"lastOpts",opts)}function urlGetData(){var e=_this.options.url,t=_this.options.ajaxType,n=_this.options.ajaxData;if(e){var r=createRequest();r.onreadystatechange=function(){if(r.readyState===4&&r.status===200){_this.options.data=typeof r.responseText==="string"?JSON.parse(r.responseText):r.responseText}};if(t&&t.toLowerCase()==="post"){r.open("post",e,false);r.setRequestHeader("Content-type","application/json;charset=utf-8");r.send(JSON.stringify(n))}else{if(n){var o="";for(var i in n){o+="&"+i+"="+n[i]}e+=e.indexOf("?")!==-1?o:o.replace("&","?")}r.open("get",e,false);r.send(null)}}else{_this.options.data=[]}}function render(){_this.menu.innerHTML="";createUl(_this.getData(true),_this.menu,null,1);menuIndent();opts.onmenuready&&eval(opts.onmenuready)&&eval(opts.onmenuready)(_this)}function createUl(e,t,o,i){var a=document.createElement("ul");e.forEach(function(e){var t=createLi(e);var n={menu:_this.menu,target:t.querySelector("a.menuitem"),options:opts,node:copyObj(e),level:i,isLeaf:false};if(opts.childrenField in n.node)delete n.node[opts.childrenField];n.node[opts.parentField]=o;t.querySelector("a.menuitem").style.background=i<colorList.length+1?colorList[i-1]:colorList[colorList.length-1];elData(t.querySelector(":scope>.menuitem"),"sender",n);if(e[opts.childrenField]&&e[opts.childrenField].length>0){t.querySelector("a").classList.add("submenu");var r=i+1;createUl(e[opts.childrenField],t,e[opts.idField],r)}else{n.isLeaf=true}a.appendChild(t)});t.appendChild(a)}function createLi(e){var t=opts.iconField?e[opts.iconField]?e[opts.iconField]:"noicon":"";var n=document.createElement("li");var r=document.createElement("a");var o=document.createElement("i");var i=document.createTextNode(e[opts.nameField]);r.setAttribute("class","menuitem");r.setAttribute("data-id",typeof e[opts.idField]==="string"?e[opts.idField].trim():e[opts.idField]);t&&o.setAttribute("class",t);r.appendChild(o);r.appendChild(i);n.appendChild(r);return n}function menuIndent(){var e=_this.menu.querySelector(".accordion>ul"),t=0,r=parseFloat(opts.indentStep);r=isNaN(r)?1:r;o(e,t);function o(e,n){var t=e.querySelectorAll(":scope>li>ul");n=parseFloat(n)+r;t.forEach(function(e){var t=e.querySelectorAll(":scope>li>a");t.forEach(function(e){e.style.paddingLeft=n+"em"});o(e,n)})}}function bindEvent(){_this.menu.querySelectorAll("a.menuitem").forEach(function(e){removeEvent(e,"click",clickFn,true);removeEvent(e,"mouseenter",enterFn,true);removeEvent(e,"mouseleave",leaveFn,true);addEvent(e,"click",clickFn,true);addEvent(e,"mouseenter",enterFn,true);addEvent(e,"mouseleave",leaveFn,true)});function enterFn(e){this.setAttribute("title",this.innerText);opts.onnodemouseenter&&eval(opts.onnodemouseenter)(elData(this,"sender"),e)}function leaveFn(e){this.removeAttribute("title");opts.onnodemouseleave&&eval(opts.onnodemouseleave)(elData(this,"sender"),e)}function clickFn(e){var speed=_this.options.speed,_self=this;if(this.classList.contains("submenu")){if(this.classList.contains("iconopen")){this.parentNode.querySelectorAll(".iconopen,ul").forEach(function(e){e.tagName==="A"?e.classList.remove("iconopen"):slideUp(e,speed)})}else{this.classList.add("iconopen");this.parentNode.parentNode.querySelectorAll(":scope>li>a").forEach(function(e){if(e!==_self){e.parentNode.querySelectorAll(".iconopen,ul").forEach(function(e){e.tagName==="A"?e.classList.remove("iconopen"):slideUp(e,speed)})}else{var t=e.parentNode.querySelector("ul");t&&slideDown(t,speed)}})}}_this.menu.querySelectorAll("a.menuitem").forEach(function(e){e.classList.remove("activeitem")});this.classList.add("activeitem");opts.onnodeclick&&eval(opts.onnodeclick)(elData(this,"sender"),e)}}function getFmtData(e){var t=copyObj(opts.data),n=[];e=typeof e==="undefined"?toBool(opts.asTreeData):toBool(e);if(e){for(var r=0;r<t.length;r++){var o=true;for(var i=0;i<t.length;i++){if(t[r][opts.idField]===t[i][opts.parentField]){o=false}}if(o){for(var a=0;a<t.length;a++){if(t[a][opts.idField]===t[r][opts.parentField]){if(!opts.childrenField in t[a]||!Array.isArray(t[a][opts.childrenField]))t[a][opts.childrenField]=[];if(opts.parentField in t[r])delete t[r][opts.parentField];t[a][opts.childrenField].push(t[r]);t.splice(r,1);r=-1;break}}}}for(var r=0;r<t.length;r++){if(opts.parentField in t[r])delete t[r][opts.parentField]}return sortTreeArr(t,opts.childrenField,opts.sortName,opts.sortOrder)}else{s(t,n,null);return sortArr(n,opts.sortOrder,opts.sortName)}function s(e,t,n){for(var r=0;r<e.length;r++){var o=copyObj(e[r]);o[opts.parentField]=opts.parentField in e[r]?e[r][opts.parentField]:n;if(opts.childrenField in o)delete o[opts.childrenField];t.push(o);if(opts.childrenField in e[r])s(e[r][opts.childrenField],t,e[r][opts.idField])}}}},getData:function(e){e=typeof e==="undefined"?toBool(this.options.asTreeData):toBool(e);return e?elData(this.menu,"tree"):elData(this.menu,"list")},getNode:function(e){var t=this.menu.querySelector("[data-id='"+e+"']");return t?elData(t,"sender").node:null},getParentNode:function(e){return this.getNode(e[this.options.parentField])},getSelectNode:function(){return elData(this.menu.querySelector("a.activeitem"),"sender").node},getChildNodes:function(n,e,r){e=typeof e==="undefined"?toBool(this.options.asTreeData):toBool(e);r=toBool(r);var o=this.options,i=copyObj(this.getData(e)),a=[];if(e){l(i)}else{s(n[o.idField])}function s(e){for(var t=0;t<i.length;t++){if(i[t][o.parentField]===e){a.push(i[t]);r&&s(i[t][o.idField]);i.splice(t,1);t=0}}return a}function l(e){e.forEach(function(t){if(t[o.idField]===n[o.idField]){if(!(o.childrenField in t)||t[o.childrenField].length===0){a=[];return a}else{a=t[o.childrenField];if(!r){a.forEach(function(e){if(o.childrenField in t){delete e[o.childrenField]}})}return a}}else{if(o.childrenField in t&&t[o.childrenField].length>0){l(t[o.childrenField])}}})}return a}};return Accordion});
